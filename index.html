<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PEGASUS - Planogram Execution Guide</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üê¥</text></svg>">
</head>
<body>
    <!-- Modal: Loading -->
    <div id="loading-overlay" class="modal-overlay">
        <div class="modal-card">
            <div class="spinner"></div>
            <h3>Initializing PEGASUS...</h3>
            <p style="font-size: 0.75rem; color: #888; margin-top: 8px;">Planogram Execution Guide And Store User Support</p>
        </div>
    </div>

    <!-- Modal: Store Selection -->
    <div id="store-modal" class="modal-overlay hidden">
        <div class="modal-card">
            <h2>üê¥ PEGASUS</h2>
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 15px;">Select Your Store</p>
            <input type="number" id="store-input" class="input-box" placeholder="Enter Store #">
            <button id="btn-load-store" class="btn-primary">Load Planogram</button>
            <p id="error-msg" class="error hidden">Store not found.</p>
        </div>
    </div>

    <!-- Modal: Scanner -->
    <div id="scanner-modal" class="modal-overlay hidden" style="flex-direction: column;">
        <button onclick="stopScanner()" class="btn-secondary" style="background:white; margin-bottom:10px;">CLOSE CAMERA X</button>
        <div id="reader"></div>
        <p style="color:white; margin-top:10px;">Point camera at barcode</p>
    </div>

    <!-- Modal: PDF -->
    <div id="pdf-modal" class="modal-overlay hidden">
        <div class="modal-card pdf-card">
            <div class="modal-header">
                <h3>Hard Copy Reference</h3>
                <button onclick="closePDF()" class="btn-secondary">Close</button>
            </div>
            <iframe id="pdf-frame"></iframe>
        </div>
    </div>

    <!-- Modal: Product Details -->
    <div id="product-modal" class="modal-overlay hidden" onclick="closeProductModal(event)">
        <div class="product-detail-card" onclick="event.stopPropagation()">
            <div class="product-detail-image">
                <img id="detail-image" src="" alt="Product Image">
            </div>
            <div class="product-detail-info">
                <div class="detail-row" style="text-align: center; margin-bottom: 15px;">
                    <span id="detail-peg" class="detail-peg-display"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Position:</span>
                    <span id="detail-position" class="detail-value detail-position-value"></span>
                </div>
                <div id="detail-facing-row" class="detail-row hidden">
                    <span class="detail-label">Facing:</span>
                    <span id="detail-facing" class="detail-value detail-facing-value"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">UPC:</span>
                    <span id="detail-upc" class="detail-value"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Description:</span>
                    <span id="detail-desc" class="detail-value"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Size:</span>
                    <span id="detail-size" class="detail-value"></span>
                </div>
            </div>
            <div class="product-detail-buttons">
                <button id="btn-set-item" class="btn-set" onclick="setItemComplete()">‚úì SET COMPLETE</button>
                <button class="btn-skip" onclick="skipToNextUnset()">SKIP ‚Üí</button>
                <button class="btn-close-detail" onclick="closeProductModal()">CLOSE</button>
            </div>
        </div>
    </div>

    <!-- Modal: Mini-Map -->
    <div id="minimap-modal" class="modal-overlay hidden" onclick="closeMinimap(event)">
        <div class="minimap-card" onclick="event.stopPropagation()">
            <div class="minimap-header">
                <h3>üó∫Ô∏è Full Set Overview</h3>
                <button onclick="closeMinimap()" class="btn-secondary">‚úï</button>
            </div>
            <div class="minimap-stats">
                <span id="minimap-total-progress">0/0 items</span>
                <span id="minimap-percent">0%</span>
            </div>
            <div id="minimap-bays" class="minimap-bays-grid"></div>
            <p class="minimap-hint">Tap any bay to jump to it</p>
        </div>
    </div>

    <!-- FLOATING BUTTONS (shown when header collapsed) -->
    <div id="floating-btns" class="floating-btns hidden">
        <button id="btn-float-scan" class="float-btn" onclick="startScanner()" title="Scan Barcode">
            <span class="float-icon">üîç</span>
        </button>
        <button id="btn-float-minimap" class="float-btn" onclick="openMinimap()" title="View All Bays">
            <img src="binocular.png" alt="Map" class="float-img" onerror="this.parentElement.innerHTML='<span class=\'float-icon\'>üó∫Ô∏è</span>'">
        </button>
        <button id="btn-float-fontsize" class="float-btn" onclick="toggleFontSize()" title="Toggle Font Size">
            <span class="float-icon">Aa</span>
        </button>
        <button id="btn-expand" class="float-btn" onclick="toggleHeader()" title="Expand Menu">
            <span class="expand-arrow">‚ñº</span>
        </button>
    </div>

    <!-- Bay Change Overlay -->
    <div id="bay-overlay" class="bay-overlay hidden">
        <div class="bay-overlay-content">
            <div class="bay-overlay-label">BAY</div>
            <div id="bay-overlay-number" class="bay-overlay-number">1</div>
        </div>
    </div>

    <!-- Row Change Toast -->
    <div id="row-toast" class="row-toast hidden">
        <span id="row-toast-text">‚¨áÔ∏è Moving to Row 5</span>
    </div>

    <!-- Delete Item Overlay -->
    <div id="delete-overlay" class="delete-overlay hidden">
        <div class="delete-overlay-content">
            <div class="delete-overlay-label">DELETE</div>
            <div id="delete-overlay-upc" class="delete-overlay-upc"></div>
            <div id="delete-overlay-desc" class="delete-overlay-desc"></div>
        </div>
    </div>

    <!-- Item Found Overlay -->
    <div id="found-overlay" class="found-overlay hidden">
        <div class="found-overlay-content">
            <div class="found-overlay-label">Item Found</div>
            <div id="found-overlay-bay" class="found-overlay-bay"></div>
            <div id="found-overlay-position" class="found-overlay-position"></div>
            <div id="found-overlay-peg" class="found-overlay-peg"></div>
        </div>
    </div>

    <!-- Item Not Found Overlay -->
    <div id="notfound-overlay" class="notfound-overlay hidden">
        <div class="notfound-overlay-content">
            <div class="notfound-overlay-label">Item Not Found!</div>
        </div>
    </div>

    <!-- Bay Complete Celebration -->
    <div id="bay-complete-overlay" class="celebration-overlay hidden">
        <div class="celebration-content">
            <div class="celebration-emoji">üéâ</div>
            <div class="celebration-title">Bay Complete!</div>
            <div id="bay-complete-text" class="celebration-subtitle">Great work!</div>
        </div>
    </div>

    <!-- POG Complete Celebration -->
    <div id="pog-complete-overlay" class="celebration-overlay pog-celebration hidden">
        <div class="celebration-content">
            <div class="celebration-emoji">üèÜ</div>
            <div class="celebration-title">SET COMPLETE!</div>
            <div id="pog-complete-text" class="celebration-subtitle">Amazing job! All items done!</div>
        </div>
        <canvas id="confetti-canvas"></canvas>
    </div>

    <!-- Multiple Matches Navigation Bar -->
    <div id="multi-match-bar" class="multi-match-bar hidden">
        <button id="btn-prev-match" class="btn-match-nav" onclick="showPrevMatch()">‚óÄ PREV</button>
        <span id="match-indicator" class="match-indicator">1 of 3</span>
        <button id="btn-next-match" class="btn-match-nav" onclick="showNextMatch()">NEXT ‚ñ∂</button>
    </div>

    <!-- MAIN HEADER (collapsible) -->
    <header id="main-header">
        <div class="header-top">
            <div class="store-info">
                <h1 id="store-display">Store: --</h1>
                <span id="pog-display">POG: --</span>
            </div>
            <div class="header-btns">
                <button onclick="startOver()" class="btn-mini btn-danger">Start Over</button>
                <button onclick="openMinimap()" class="btn-mini">Map</button>
                <button onclick="openPDF()" class="btn-mini">PDF</button>
                <button onclick="resetStore()" class="btn-mini">Switch</button>
                <button onclick="toggleHeader()" class="btn-mini btn-collapse">‚ñ≤</button>
            </div>
        </div>

        <!-- Search & Scan Controls -->
        <div class="tools-container">
            <button id="btn-scan-toggle" class="btn-scan-large">üì∑ SCAN BARCODE</button>
            
            <div class="manual-search-row">
                <input type="text" id="search-input" placeholder="Manual UPC Entry...">
                <button id="btn-manual-search" class="btn-go">Search</button>
            </div>
            
            <div id="scan-debug">Last Scanned: <span id="scan-result">--</span></div>
        </div>

        <!-- Navigation -->
        <div class="nav-row">
            <button class="nav-arrow" onclick="changeBay(-1)">‚ùÆ</button>
            <div id="bay-indicator">Bay 1</div>
            <button class="nav-arrow" onclick="changeBay(1)">‚ùØ</button>
        </div>

        <!-- Progress -->
        <div class="progress-bar-bg">
            <div id="progress-fill" class="progress-fill"></div>
        </div>
        <div class="progress-text"><span id="progress-count">0/0</span> Complete</div>
    </header>

    <!-- PEGBOARD CANVAS -->
    <main id="main-canvas">
        <div id="grid-container"></div>
    </main>

    <script src="app.js"></script>
</body>
</html>
